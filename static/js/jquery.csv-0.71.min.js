RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};
(function(e){e.csv={defaults:{separator:",",delimiter:'"',headers:!0},hooks:{castToScalar:function(c){if(isNaN(c))return c;if(/\./.test(c))return parseFloat(c);c=parseInt(c);return isNaN(c)?null:c}},parsers:{parse:function(c,a){function f(){k=0;h="";if(a.start&&a.state.rowNum<a.start)d=[];else{if(void 0===a.onParseEntry)g.push(d);else{var b=a.onParseEntry(d,a.state);!1!==b&&g.push(b)}d=[];a.end&&a.state.rowNum>=a.end&&(m=!0)}a.state.rowNum++;a.state.colNum=1}function b(){if(void 0===a.onParseValue)d.push(h);
else{var b=a.onParseValue(h,a.state);!1!==b&&d.push(b)}h="";k=0;a.state.colNum++}var e=a.separator,j=a.delimiter;a.state.rowNum||(a.state.rowNum=1);a.state.colNum||(a.state.colNum=1);var g=[],d=[],k=0,h="",m=!1,l=RegExp.escape(e),q=RegExp.escape(j),n=/(D|S|\n|\r|[^DS\r\n]+)/,n=n.source,n=n.replace(/S/g,l),n=n.replace(/D/g,q),n=RegExp(n,"gm");c.replace(n,function(d){if(!m)switch(k){case 0:if(d===e){h+="";b();break}if(d===j){k=1;break}if("\n"===d){b();f();break}if(/^\r$/.test(d))break;h+=d;k=3;break;
case 1:if(d===j){k=2;break}h+=d;k=1;break;case 2:if(d===j){h+=d;k=1;break}if(d===e){b();break}if("\n"===d){b();f();break}if(/^\r$/.test(d))break;throw Error("CSVDataError: Illegal State [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");case 3:if(d===e){b();break}if("\n"===d){b();f();break}if(/^\r$/.test(d))break;if(d===j)throw Error("CSVDataError: Illegal Quote [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");throw Error("CSVDataError: Illegal Data [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+
"]");default:throw Error("CSVDataError: Unknown State [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");}});0!==d.length&&(b(),f());return g},splitLines:function(c,a){function f(){g=0;if(a.start&&a.state.rowNum<a.start)d="";else{if(void 0===a.onParseEntry)j.push(d);else{var b=a.onParseEntry(d,a.state);!1!==b&&j.push(b)}d="";a.end&&a.state.rowNum>=a.end&&(k=!0)}a.state.rowNum++}var b=a.separator,e=a.delimiter;a.state.rowNum||(a.state.rowNum=1);var j=[],g=0,d="",k=!1,h=RegExp.escape(b),m=RegExp.escape(e),
l=/(D|S|\n|\r|[^DS\r\n]+)/,l=l.source,l=l.replace(/S/g,h),l=l.replace(/D/g,m),l=RegExp(l,"gm");c.replace(l,function(c){if(!k)switch(g){case 0:if(c===b){d+=c;g=0;break}if(c===e){d+=c;g=1;break}if("\n"===c){f();break}if(/^\r$/.test(c))break;d+=c;g=3;break;case 1:if(c===e){d+=c;g=2;break}d+=c;g=1;break;case 2:var l=d.substr(d.length-1);if(c===e&&l===e){d+=c;g=1;break}if(c===b){d+=c;g=0;break}if("\n"===c){f();break}if("\r"===c)break;throw Error("CSVDataError: Illegal state [Row:"+a.state.rowNum+"]");
case 3:if(c===b){d+=c;g=0;break}if("\n"===c){f();break}if("\r"===c)break;if(c===e)throw Error("CSVDataError: Illegal quote [Row:"+a.state.rowNum+"]");throw Error("CSVDataError: Illegal state [Row:"+a.state.rowNum+"]");default:throw Error("CSVDataError: Unknown state [Row:"+a.state.rowNum+"]");}});""!==d&&f();return j},parseEntry:function(c,a){function f(){if(void 0===a.onParseValue)j.push(d);else{var b=a.onParseValue(d,a.state);!1!==b&&j.push(b)}d="";g=0;a.state.colNum++}var b=a.separator,e=a.delimiter;
a.state.rowNum||(a.state.rowNum=1);a.state.colNum||(a.state.colNum=1);var j=[],g=0,d="";if(!a.match){var k=RegExp.escape(b),h=RegExp.escape(e),m=/(D|S|\n|\r|[^DS\r\n]+)/.source,m=m.replace(/S/g,k),m=m.replace(/D/g,h);a.match=RegExp(m,"gm")}c.replace(a.match,function(c){switch(g){case 0:if(c===b){d+="";f();break}if(c===e){g=1;break}if("\n"===c||"\r"===c)break;d+=c;g=3;break;case 1:if(c===e){g=2;break}d+=c;g=1;break;case 2:if(c===e){d+=c;g=1;break}if(c===b){f();break}if("\n"===c||"\r"===c)break;throw Error("CSVDataError: Illegal State [Row:"+
a.state.rowNum+"][Col:"+a.state.colNum+"]");case 3:if(c===b){f();break}if("\n"===c||"\r"===c)break;if(c===e)throw Error("CSVDataError: Illegal Quote [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");throw Error("CSVDataError: Illegal Data [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");default:throw Error("CSVDataError: Unknown State [Row:"+a.state.rowNum+"][Col:"+a.state.colNum+"]");}});f();return j}},toArray:function(c,a,f){a=void 0!==a?a:{};var b={};b.callback=void 0!==f&&"function"===typeof f?
f:!1;b.separator="separator"in a?a.separator:e.csv.defaults.separator;b.delimiter="delimiter"in a?a.delimiter:e.csv.defaults.delimiter;a={delimiter:b.delimiter,separator:b.separator,onParseEntry:a.onParseEntry,onParseValue:a.onParseValue,state:void 0!==a.state?a.state:{}};c=e.csv.parsers.parseEntry(c,a);if(b.callback)b.callback("",c);else return c},toArrays:function(c,a,f){a=void 0!==a?a:{};var b={};b.callback=void 0!==f&&"function"===typeof f?f:!1;b.separator="separator"in a?a.separator:e.csv.defaults.separator;
b.delimiter="delimiter"in a?a.delimiter:e.csv.defaults.delimiter;f=[];a={delimiter:b.delimiter,separator:b.separator,onParseEntry:a.onParseEntry,onParseValue:a.onParseValue,start:a.start,end:a.end,state:{rowNum:1,colNum:1}};f=e.csv.parsers.parse(c,a);if(b.callback)b.callback("",f);else return f},toObjects:function(c,a,f){a=void 0!==a?a:{};var b={};b.callback=void 0!==f&&"function"===typeof f?f:!1;b.separator="separator"in a?a.separator:e.csv.defaults.separator;b.delimiter="delimiter"in a?a.delimiter:
e.csv.defaults.delimiter;b.headers="headers"in a?a.headers:e.csv.defaults.headers;a.start="start"in a?a.start:1;b.headers&&a.start++;a.end&&b.headers&&a.end++;var p=[];f=[];a={delimiter:b.delimiter,separator:b.separator,onParseEntry:a.onParseEntry,onParseValue:a.onParseValue,start:a.start,end:a.end,state:{rowNum:1,colNum:1},match:!1};var p=e.csv.parsers.splitLines(c,{delimiter:b.delimiter,separator:b.separator,start:1,end:1,state:{rowNum:1,colNum:1}}),j=e.csv.toArray(p[0],a),p=e.csv.parsers.splitLines(c,
a);a.state.colNum=1;a.state.rowNum=j?2:1;c=0;for(var g=p.length;c<g;c++){var d=e.csv.toArray(p[c],a),k={},h;for(h in j)k[j[h]]=d[h];f.push(k);a.state.rowNum++}if(b.callback)b.callback("",f);else return f},fromArrays:function(c,a,f){a=void 0!==a?a:{};var b={};b.callback=void 0!==f&&"function"===typeof f?f:!1;b.separator="separator"in a?a.separator:e.csv.defaults.separator;b.delimiter="delimiter"in a?a.delimiter:e.csv.defaults.delimiter;b.escaper="escaper"in a?a.escaper:e.csv.defaults.escaper;b.experimental=
"experimental"in a?a.experimental:!1;if(!b.experimental)throw Error("not implemented");a=[];for(i in c)a.push(c[i]);if(b.callback)b.callback("",a);else return a},fromObjects2CSV:function(c,a,f){a=void 0!==a?a:{};var b={};b.callback=void 0!==f&&"function"===typeof f?f:!1;b.separator="separator"in a?a.separator:e.csv.defaults.separator;b.delimiter="delimiter"in a?a.delimiter:e.csv.defaults.delimiter;b.experimental="experimental"in a?a.experimental:!1;if(!b.experimental)throw Error("not implemented");
a=[];for(i in c)a.push(arrays[i]);if(b.callback)b.callback("",a);else return a}};e.csvEntry2Array=e.csv.toArray;e.csv2Array=e.csv.toArrays;e.csv2Dictionary=e.csv.toObjects})(jQuery);
