(function(c){var y=(c.browser.msie?"paste":"input")+".mask",z=void 0!=window.orientation;c.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"};c.fn.extend({caret:function(c,f){if(0!=this.length){if("number"==typeof c)return f="number"==typeof f?f:c,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(c,f);else if(this.createTextRange){var g=this.createTextRange();g.collapse(!0);g.moveEnd("character",f);g.moveStart("character",c);g.select()}});if(this[0].setSelectionRange)c=
this[0].selectionStart,f=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var q=document.selection.createRange();c=0-q.duplicate().moveStart("character",-1E5);f=c+q.text.length}return{begin:c,end:f}}},unmask:function(){return this.trigger("unmask")},isMaskValid:function(){return c(this).data("mask-isvalid")},mask:function(p,f){if(!p&&0<this.length)return c(this[0]).data(c.mask.dataName)();f=c.extend({placeholder:"_",completed:null},f);var q=c.mask.definitions,g=[],
l=p.length,s=null,k=p.length;c.each(p.split(""),function(c,f){"?"==f?(k--,l=c):q[f]?(g.push(RegExp(q[f])),null==s&&(s=g.length-1)):g.push(null)});return this.trigger("unmask").each(function(){function m(a){for(;++a<=k&&!g[a];);return a}function x(a,d){if(!(0>a)){for(var b=a,h=m(d);b<k;b++)if(g[b]){if(h<k&&g[b].test(j[h]))j[b]=j[h],j[h]=f.placeholder;else break;h=m(h)}t();e.caret(Math.max(s,a))}}function A(a){a=a.which;if(8==a||46==a||z&&127==a){var d=e.caret(),b=d.begin,d=d.end;if(0==d-b){if(46!=
a)for(;0<=--b&&!g[b];);else b=d=m(b-1);d=46==a?m(d):d}u(b,d);x(b,d-1);v();return!1}if(27==a)return e.val(w),e.caret(0,r()),!1}function B(a){var d=a.which,b=e.caret();if(a.ctrlKey||a.altKey||a.metaKey||32>d)return!0;if(d){0!=b.end-b.begin&&(u(b.begin,b.end),x(b.begin,b.end-1),v());a=m(b.begin-1);if(a<k&&(d=String.fromCharCode(d),g[a].test(d))){for(var b=a,h=f.placeholder;b<k;b++)if(g[b]){var c=m(b),l=j[b];j[b]=h;if(c<k&&g[c].test(l))h=l;else break}j[a]=d;t();a=m(a);e.caret(a);v();f.completed&&a>=k&&
f.completed.call(e)}return!1}}function u(a,d){for(var b=a;b<d&&b<k;b++)g[b]&&(j[b]=f.placeholder)}function t(){return e.val(j.join("")).val()}function v(){for(var a=e.val(),d=-1,b=0,c=0;b<k;b++)if(g[b]){for(j[b]=f.placeholder;c++<a.length;){var n=a.charAt(c-1);if(g[b].test(n)){j[b]=n;d=b;break}}if(c>a.length)break}else j[b]==a.charAt(c)&&b!=l&&(c++,d=b);a=d+1>=l;e.data("mask-isvalid",a);return a}function r(a){for(var c=e.val(),b=-1,h=0,n=0;h<k;h++)if(g[h]){for(j[h]=f.placeholder;n++<c.length;){var m=
c.charAt(n-1);if(g[h].test(m)){j[h]=m;b=h;break}}if(n>c.length)break}else j[h]==c.charAt(n)&&h!=l&&(n++,b=h);if(!a&&b+1<l)e.val(""),u(0,k);else if(a||b+1>=l)t(),a||e.val(e.val().substring(0,b+1));return l?h:s}var e=c(this),j=c.map(p.split(""),function(a){if("?"!=a)return q[a]?f.placeholder:a}),w=e.val();e.data(c.mask.dataName,function(){return c.map(j,function(a,c){return g[c]&&a!=f.placeholder?a:null}).join("")});e.attr("readonly")||e.one("unmask",function(){e.unbind(".mask").removeData(c.mask.dataName)}).bind("focus.mask",
function(){w=e.val();var a=r();t();var d=function(){a==p.length?e.caret(0,a):e.caret(a)};(c.browser.msie?d:function(){setTimeout(d,0)})()}).bind("blur.mask",function(){r();e.val()!=w&&e.change()}).bind("keydown.mask",A).bind("keypress.mask",B).bind(y,function(){setTimeout(function(){e.caret(r(!0))},0)});r()})}})})(jQuery);
